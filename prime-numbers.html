<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prime Number Challenge</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body { font-family: "Inter", sans-serif; }
      .btn { transition: transform .05s ease; }
      .btn:active { transform: translateY(1px); }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-800 min-h-screen">
    <div class="max-w-3xl mx-auto px-4 py-8 md:py-12">
      <header class="flex items-center justify-between mb-8">
        <a href="index.html" class="inline-flex items-center text-sm text-gray-600 hover:text-gray-900">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Back to Hub
        </a>
        <h1 class="text-2xl md:text-3xl font-bold">Prime Number Challenge</h1>
        <div class="w-20"></div>
      </header>

      <section class="bg-white rounded-2xl border border-gray-200 shadow-sm p-6 md:p-8">
        <!-- Scoreboard -->
        <div class="grid grid-cols-3 gap-4 text-center mb-6">
          <div>
            <div class="text-xs uppercase tracking-wide text-gray-500">Score</div>
            <div id="score" class="text-2xl font-bold">0</div>
          </div>
          <div>
            <div class="text-xs uppercase tracking-wide text-gray-500">Streak</div>
            <div id="streak" class="text-2xl font-bold">0</div>
          </div>
          <div>
            <div class="text-xs uppercase tracking-wide text-gray-500">Lives</div>
            <div id="lives" class="text-2xl font-bold text-rose-600">❤❤❤</div>
          </div>
        </div>

        <!-- Number card -->
        <div class="flex items-center justify-center mb-6">
          <div class="h-28 w-28 md:h-36 md:w-36 rounded-full bg-indigo-50 text-indigo-700 flex items-center justify-center shadow-inner border border-indigo-100">
            <span id="number" class="text-4xl md:text-5xl font-extrabold">2</span>
          </div>
        </div>

        <!-- Prompt -->
        <p class="text-center text-gray-700 mb-4">Is this number prime or composite?</p>

        <!-- Buttons -->
        <div class="flex items-center justify-center gap-4 md:gap-6 mb-4">
          <button id="primeBtn" class="btn px-5 py-3 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-semibold shadow-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2">
            Prime (P)
          </button>
          <button id="compositeBtn" class="btn px-5 py-3 rounded-lg bg-rose-600 hover:bg-rose-700 text-white font-semibold shadow-sm focus:outline-none focus:ring-2 focus:ring-rose-500 focus:ring-offset-2">
            Composite (C)
          </button>
        </div>

        <!-- Feedback -->
        <div id="feedback" class="min-h-[3rem] text-center" aria-live="polite"></div>

        <!-- Next -->
        <div class="text-center">
          <button id="nextBtn" class="btn px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white font-medium shadow-sm disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            Next
          </button>
        </div>
      </section>

      <!-- Tips / Learning -->
      <section class="mt-8">
        <details class="bg-white rounded-xl border border-gray-200 p-5 shadow-sm group" open>
          <summary class="cursor-pointer list-none flex items-center justify-between">
            <span class="font-semibold text-gray-900">Prime tips and tricks</span>
            <svg class="w-5 h-5 text-gray-500 transition-transform group-open:rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </summary>
          <ul class="mt-3 list-disc pl-5 text-gray-700 space-y-1">
            <li>1 is not prime and not composite. We start at 2.</li>
            <li>2 is the only even prime. Any even number greater than 2 is composite.</li>
            <li>If the sum of digits is divisible by 3, the number is divisible by 3.</li>
            <li>Numbers ending in 5 (except 5) are divisible by 5.</li>
            <li>To test primality, you only need to try dividing by primes up to √n.</li>
            <li>Small primes to remember: 2, 3, 5, 7, 11, 13, 17, 19.</li>
          </ul>
        </details>
      </section>

      <!-- Game Over Modal -->
      <div id="gameOver" class="fixed inset-0 bg-black/40 hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl max-w-md w-full p-6 text-center">
          <h2 class="text-2xl font-bold mb-2">Game Over</h2>
          <p id="finalStats" class="text-gray-700 mb-6"></p>
          <div class="flex items-center justify-center gap-3">
            <button id="restartBtn" class="px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white font-semibold">Play Again</button>
            <a href="index.html" class="px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-900 font-semibold border border-gray-300">Back to Hub</a>
          </div>
        </div>
      </div>
    </div>

    <script>
      // --- Game State ---
      let score = 0;
      let streak = 0;
      let lives = 3;
      let current = 2;
      let awaitingAnswer = true;

      const scoreEl = document.getElementById('score');
      const streakEl = document.getElementById('streak');
      const livesEl = document.getElementById('lives');
      const numberEl = document.getElementById('number');
      const primeBtn = document.getElementById('primeBtn');
      const compositeBtn = document.getElementById('compositeBtn');
      const feedbackEl = document.getElementById('feedback');
      const nextBtn = document.getElementById('nextBtn');
      const gameOverEl = document.getElementById('gameOver');
      const finalStatsEl = document.getElementById('finalStats');
      const restartBtn = document.getElementById('restartBtn');

      // Pools to control frequency of primes vs composites
      let primes = [];
      let composites = [];

      function setLivesDisplay() {
        livesEl.textContent = '❤'.repeat(lives) + '♡'.repeat(3 - lives);
      }

      function randInt(min, max) { // inclusive
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      // Returns { isPrime: boolean, factor: number|null }
      function checkPrimeWithFactor(n) {
        if (n < 2) return { isPrime: false, factor: null };
        if (n % 2 === 0) return n === 2 ? { isPrime: true, factor: null } : { isPrime: false, factor: 2 };
        if (n % 3 === 0) return n === 3 ? { isPrime: true, factor: null } : { isPrime: false, factor: 3 };
        let i = 5;
        const limit = Math.floor(Math.sqrt(n));
        while (i <= limit) {
          if (n % i === 0) return { isPrime: false, factor: i };
          const j = i + 2; // 6k + 1 / 6k + 3 already covered by 3
          if (n % j === 0) return { isPrime: false, factor: j };
          i += 6;
        }
        return { isPrime: true, factor: null };
      }

      function buildPools() {
        primes = [];
        composites = [];
        for (let n = 2; n <= 199; n++) {
          const { isPrime } = checkPrimeWithFactor(n);
          (isPrime ? primes : composites).push(n);
        }
      }

      function pickNextNumber() {
        // Bias toward primes so they appear more often
        const wantPrime = Math.random() < 0.6; // 60% chance prime, 40% composite
        const pool = wantPrime ? primes : composites;
        const n = pool[Math.floor(Math.random() * pool.length)];
        current = n;
        numberEl.textContent = n;
        awaitingAnswer = true;
        feedbackEl.innerHTML = '';
        primeBtn.disabled = false;
        compositeBtn.disabled = false;
        nextBtn.disabled = true;
      }

      function showFeedback(correct, explanation) {
        const base = correct
          ? '<div class="inline-flex items-center px-3 py-2 rounded-lg bg-emerald-50 text-emerald-700 border border-emerald-200">' +
            '<svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>' +
            '<div><div class="font-semibold">Correct!</div>'
          : '<div class="inline-flex items-center px-3 py-2 rounded-lg bg-rose-50 text-rose-700 border border-rose-200">' +
            '<svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>' +
            '<div><div class="font-semibold">Not quite.</div>';
        feedbackEl.innerHTML = base + (explanation ? '<div class="text-sm text-gray-700 mt-1">' + explanation + '</div>' : '') + '</div></div>';
      }

      function handleAnswer(chosenPrime) {
        if (!awaitingAnswer) return;
        awaitingAnswer = false;
        const { isPrime, factor } = checkPrimeWithFactor(current);
        const correct = (chosenPrime && isPrime) || (!chosenPrime && !isPrime);

        if (correct) {
          score += 10;
          streak += 1;
          showFeedback(true, isPrime
            ? current + ' is only divisible by 1 and ' + current + '.'
            : (function(){
                const other = factor ? Math.floor(current / factor) : '';
                return current + ' = ' + factor + ' × ' + other + ', so it\'s composite.';
              })()
          );
        } else {
          lives -= 1;
          streak = 0;
          let explanation = '';
          if (isPrime) {
            explanation = current + ' has no divisors other than 1 and ' + current + '.';
          } else {
            const other = factor ? Math.floor(current / factor) : '';
            explanation = current + ' = ' + factor + ' × ' + other + ', so it\'s composite.';
          }
          showFeedback(false, explanation);
        }

        scoreEl.textContent = score;
        streakEl.textContent = streak;
        setLivesDisplay();

        primeBtn.disabled = true;
        compositeBtn.disabled = true;
        nextBtn.disabled = false;

        if (lives <= 0) {
          setTimeout(() => endGame(), 600);
        }
      }

      function endGame() {
        finalStatsEl.textContent = `Your score: ${score}. Best streak this run: ${streak}.`;
        gameOverEl.classList.remove('hidden');
        gameOverEl.classList.add('flex');
      }

      function restart() {
        score = 0; streak = 0; lives = 3;
        scoreEl.textContent = '0';
        streakEl.textContent = '0';
        setLivesDisplay();
        feedbackEl.innerHTML = '';
        gameOverEl.classList.add('hidden');
        gameOverEl.classList.remove('flex');
        pickNextNumber();
      }

      // Event listeners
      primeBtn.addEventListener('click', () => handleAnswer(true));
      compositeBtn.addEventListener('click', () => handleAnswer(false));
      nextBtn.addEventListener('click', pickNextNumber);
      restartBtn.addEventListener('click', restart);

      // Keyboard shortcuts: P for prime, C for composite, N or Space for next
      window.addEventListener('keydown', (e) => {
        if (gameOverEl.classList.contains('hidden')) {
          if ((e.key === 'p' || e.key === 'P')) { e.preventDefault(); handleAnswer(true); }
          if ((e.key === 'c' || e.key === 'C')) { e.preventDefault(); handleAnswer(false); }
          if ((e.key === 'n' || e.key === 'N' || e.key === ' ')) { e.preventDefault(); if (!nextBtn.disabled) pickNextNumber(); }
        } else {
          if (e.key === 'Enter') restart();
        }
      });

      // Init
      buildPools();
      setLivesDisplay();
      pickNextNumber();
    </script>
  </body>
</html>
